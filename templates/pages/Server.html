{% extends "base/Content.html" %}

{% block page_title %}
	{{ server.Name }}
{% endblock %}

{% block content %}
	
	<!-- Start: Header -->
	<div id="header">
		<h1>
			<span style="text-align: left;">
				{{ server.Name }} <small>:{{ server.Port }} <span class="label label-danger">Offline</span></small>
			</span>
			<span style="float: right;">
				
				<button type="button" class="btn btn-danger" >Delete</button>
				
				<small>Owner: {{ server.User.Username }}</small>
			</span>
		</h1>
	</div>
	<!-- End: Header -->
	
	<hr>
	
	<!-- Start: Panel: Console -->
	<div class="col-sm-12">
		<div id="control" class="panel panel-info">
			<div class="panel-heading">
				<h3 class="panel-title" style="text-align: center;">
					Control
				</h3>
			</div>
			<div class="panel-body" style="text-align: center;">
				
				<button type="button" class="btn btn-success" style="width: 30%;">Start</button>
				<button type="button" class="btn btn-warning" style="width: 30%;">Stop</button>
				<button type="button" class="btn btn-danger"  style="width: 30%;">Kill</button>
				
				<hr>
				
				<form action="#" method="POST" enctype="multipart/form-data">
					<textarea id="console" class="form-control"
							style="font-family: monospace; min-height: 200px; font-size: 11px;"
							readonly cols="20" wrap="hard"
						></textarea>
					<input id="command" type="text" name="command" placeholder="Command" class="form-control" />
				</form>
			</div>
		</div>
	</div>
	<!-- End: Panel: Console -->
	
	{% if userIsAdmin %}
	
	<!-- Start: Panel: Server Info -->
	<div class="col-sm-3">
		<div id="quick" class="panel panel-green">
			<div class="panel-heading">
				<h3 class="panel-title" style="text-align: center;">
					Server Information
				</h3>
			</div>
			<div class="panel-body" style="text-align: center;">
				
				<div id="playerStatus">
					{% set players_total = 20 %}
					{% set players_online = 2 %}
					
					{% with min=0, max=players_total, number=players_online, message=[players_online, " Players Online"]|join %}
						{% include 'component/widgets/progressbar.html' %}
					{% endwith %}
				</div>
				
				<div id="diskStatus">
					<label>Disk Space</label>
					<div class="flot-chart">
						<div class="flot-chart-content" id="diskspace" ></div>
					</div>
				</div>
				
			</div>
		</div>
	</div>
	<!-- End: Panel: Server Info -->
	
	<!-- Start: Panel: Danger Zone -->
	<div class="col-sm-9">
		<div id="danger" class="panel panel-danger">
			<div class="panel-heading">
				<h3 class="panel-title" style="text-align: center;">
					Danger Zoneâ„¢
				</h3>
			</div>
			<div class="panel-body" style="text-align: center;">
				
				<!-- Start: Body: Danger Zone -->
				
				<!-- Start: Panel: Moderators -->
				<div class="col-sm-6">
					<div id="moderators" class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title" style="text-align: center;">
								Moderators
								<button id="addModerator" type="button" class="btn btn-success btn-circle btn-sm"
										data-toggle="modal" data-target="#addModeratorModal"
										data-username="{{ server.User.Username }}" data-servername="{{ server.Name }}"
									>
									<i class="fa fa-plus"></i>
								</button>
							</h3>
						</div>
						<div class="panel-body">
							Usernames on the backend.
							<br />
							Can start, stop & use console.
							
							<table class="table table-striped table-bordered">
								<thread><tr>
									<th>Name</th>
									<th></th>
								</tr></thread>
								<tbody>
									{% for user in moderators %}
										<tr>
											<td>{{ user.Username }}</td>
											<td>
												
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<!-- End: Panel: Moderators -->
				
				<!-- Start: Panel: Admins -->
				<div class="col-sm-6">
					<div id="admins" class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title" style="text-align: center;">
								Admins
								<button id="addAdmin" type="button" class="btn btn-success btn-circle btn-sm"
										data-toggle="modal" data-target="#addAdminModal"
										data-username="{{ server.User.Username }}" data-servername="{{ server.Name }}"
									>
									<i class="fa fa-plus"></i>
								</button>
							</h3>
						</div>
						<div class="panel-body">
							Usernames on the backend.
							<br />
							Can do everything except modify mods & admins and delete server.
							<table class="table table-striped table-bordered">
								<thread><tr>
									<th>Name</th>
									<th></th>
								</tr></thread>
								<tbody>
									{% for user in admins %}
										<tr>
											<td>{{ user.Username }}</td>
											<td>
												
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<!-- End: Panel: Admins -->
				
				<!-- Start: Panel: Restart -->
				<div class="col-sm-6">
					<div id="restart" class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title" style="text-align: center;">
								Restart Info
							</h3>
						</div>
						<div class="panel-body">
							<form action="{{ url_for('index') }}" method="POST" enctype="multipart/form-data">
								
								<div class="form-group">
									<input type="checkbox" /> <label>Autostart</label>
									&nbsp;
									<label><small>Last autostart: {{ autostartLast }}</small></label>
								</div>
								
								<hr>
								
								<div class="form-group">
									<input type="checkbox" /> <label>Use Reboot Schedule</label>
								</div>
								
								<div class="form-group">
									<label>Reboot Schedule</label>
									<div class="input-group col-sm-4 col-sm-offset-4">
										<input type="number" aria-describedby="helpBlock" min="0" max="23" placeholder="0" class="form-control" />
										<div class="input-group-addon">h</div>
										<input type="number" aria-describedby="helpBlock" min="0" max="59" placeholder="0" class="form-control" />
									</div>
								</div>
								
								<div class="form-group">
									<div class="input-group">
										<input name="reboot_message" type="text" value="Server reboot in %time minutes!" class="form-control" />
										<div class="input-group-addon">%time = time left in min</div>
									</div>
									<small>This message gets send at: T- 15, 10, 5, 4, 3, 2, 1, 0 min.</small>
								</div>
								
								<hr>
								
								<button type="submit" class="btn btn-primary btn-lg btn-block">Save</button>
							</form>
						</div>
					</div>
				</div>
				<!-- End: Panel: Restart -->
				
				<!-- Start: Panel: Custom -->
				{% include ['pages/server/Panel', server.Purpose, '.html']|join %}
				<!-- End: Panel: Custom -->
				
				<!-- End: Body: Danger Zone -->
				
			</div>
		</div>
	</div>
	<!-- End: Panel: Danger Zone -->
	
	<!-- Start: Panel: File Manip -->
	<div class="col-sm-12">
		<div id="filemanip" class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title" style="text-align: center;">
					File Manipulation
				</h3>
			</div>
			<div class="panel-body" style="text-align: center;">
				
				
				
			</div>
		</div>
	</div>
	<!-- End: Panel: File Manip -->
	
	{% endif %}
	
{% endblock %}

{% block scripts %}
	{% include 'component/modal/AddModerator.html' %}
	{% include 'component/modal/AddAdmin.html' %}
	<script type="text/javascript" language="javascript">
		$(window).load(function() {
			var data = [
				{label: "Files", data: 1, color: "#62A83B"},
				{label: "Backups", data: 2, color: "#2897CB"},
				{label: "Free", data: 3, color: "#DEAB34"}
			];
			
			var options = {
				series: {
					pie: {
						show: true,
						radius: 150,
						label: {
							show: true,
							radius: 0.5, // place in middle of pie slice
							formatter: function(label, series){
								var value = series.data[0][1];
								return ('&nbsp;<b>' + label + '</b><br /><b>' + value + ' mb</b>');
							}
						}
					}
				},
				legend: {
					show: false
				}
			};
			
			$.plot($("#diskspace"), data, options);
		});
		
	</script>
	<script type="text/javascript" language="javascript">
		$(document).ready(function() {
			
			var updateConsole = function(textarea) {
				var id = textarea.id;
				$.post("{{ url_for('getConsole') }}",
					{
						serverName : "{{ server.Name }}",
						ownerName : "{{ server.User.Username }}"
					},
					function(data, textstatus) {
						textarea.innerHTML = data['console'];
					}, "json");
			};
			
			updateConsole(document.getElementById("console"));
			var checkWidgetsHalfSecond = setInterval(function() {
				updateConsole(document.getElementById("console"));
			}, 250);
		});
	</script>
{% endblock %}
